<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sign in — BrokerZ</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0c0f14;
      --surface: #141922;
      --surface-hover: #1a1f2a;
      --border: rgba(255,255,255,0.08);
      --text: #f1f3f5;
      --text-muted: #8b95a5;
      --accent: #e8a317;
      --accent-dim: #c48912;
      --radius: 14px;
      --radius-sm: 10px;
      --shadow: 0 20px 50px rgba(0,0,0,0.4);
      --error: #ef4444;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Plus Jakarta Sans", ui-sans-serif, system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 24px;
      overflow-x: hidden;
    }

    .login-bg {
      position: fixed;
      inset: 0;
      background:
        radial-gradient(ellipse 70% 50% at 50% -15%, rgba(232, 163, 23, 0.1), transparent 50%),
        radial-gradient(ellipse 50% 40% at 100% 50%, rgba(59, 130, 246, 0.05), transparent 45%);
      pointer-events: none;
      z-index: 0;
    }

    .back-link {
      position: relative;
      z-index: 1;
      align-self: flex-start;
      margin-bottom: 16px;
      color: var(--text-muted);
      text-decoration: none;
      font-weight: 500;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: color 0.2s;
    }
    .back-link:hover { color: var(--accent); }
    .lang-toggle {
      position: relative;
      z-index: 1;
      align-self: flex-end;
      margin-bottom: 12px;
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text);
      border-radius: var(--radius-sm);
      padding: 8px 12px;
      font-family: inherit;
      font-weight: 700;
      cursor: pointer;
    }

    .login-card {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 420px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 32px;
      box-shadow: var(--shadow);
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 800;
      letter-spacing: -0.03em;
      color: var(--text);
      text-decoration: none;
      display: inline-block;
      margin-bottom: 28px;
    }
    .logo span { color: var(--accent); }

    .portal-tabs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 28px;
    }
    .portal-tab {
      padding: 12px 16px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text-muted);
      font-weight: 500;
      font-family: inherit;
      font-size: 0.95rem;
      cursor: pointer;
      transition: color 0.2s, background 0.2s, border-color 0.2s;
    }
    .portal-tab:hover { color: var(--text); background: var(--surface-hover); }
    .portal-tab.active {
      background: rgba(232, 163, 23, 0.15);
      border-color: var(--accent);
      color: var(--accent);
    }

    .form-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin: 0 0 24px 0;
      letter-spacing: -0.02em;
    }

    .form-panel { display: none; }
    .form-panel.active { display: block; }

    .field {
      margin-bottom: 18px;
    }
    .field label {
      display: block;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 8px;
    }
    .field input {
      width: 100%;
      padding: 12px 16px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text);
      font-family: inherit;
      font-size: 0.95rem;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    .field input::placeholder { color: var(--text-muted); }
    .field input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(232, 163, 23, 0.2);
    }
    .field input.error { border-color: var(--error); }
    .field .error-msg {
      font-size: 0.8rem;
      color: var(--error);
      margin-top: 6px;
      display: none;
    }
    .field .error-msg.visible { display: block; }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .submit-btn {
      width: 100%;
      margin-top: 8px;
      padding: 14px;
      background: linear-gradient(135deg, var(--accent), var(--accent-dim));
      color: #0c0f14;
      font-weight: 600;
      font-family: inherit;
      font-size: 0.95rem;
      border: 0;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: transform 0.15s, box-shadow 0.2s;
    }
    .submit-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 24px rgba(232, 163, 23, 0.35);
    }

    .toggle-mode {
      margin-top: 24px;
      text-align: center;
      font-size: 0.9rem;
      color: var(--text-muted);
    }
    .toggle-mode a {
      color: var(--accent);
      font-weight: 500;
      text-decoration: none;
      cursor: pointer;
    }
    .toggle-mode a:hover { text-decoration: underline; }

    .portal-badge {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      margin-bottom: 20px;
    }
    .portal-badge span { color: var(--accent); }

    .form-err {
      display: block;
      margin-bottom: 12px;
      padding: 10px 12px;
      background: rgba(239, 68, 68, 0.12);
      border-radius: var(--radius-sm);
    }
    .form-err:empty { display: none !important; }
    .submit-btn:disabled { opacity: 0.7; cursor: not-allowed; }

    @media (max-width: 640px) {
      body { padding: 14px; }
      .lang-toggle { align-self: stretch; margin-bottom: 10px; }
      .back-link { margin-bottom: 10px; }
      .login-card {
        max-width: 100%;
        padding: 18px 14px;
      }
      .logo { margin-bottom: 18px; }
      .portal-tabs { margin-bottom: 18px; gap: 6px; }
      .portal-tab { padding: 10px 8px; font-size: 0.88rem; }
      .form-title { margin-bottom: 16px; }
      .field { margin-bottom: 14px; }
      .row { grid-template-columns: 1fr; gap: 0; }
      .submit-btn { padding: 12px; }
      .toggle-mode { margin-top: 16px; font-size: 0.85rem; }
    }
  </style>
</head>
<body>
  <div class="login-bg" aria-hidden="true"></div>
  <button type="button" class="lang-toggle" id="lang-toggle">AR</button>
  <a href="index.html?reset=1" class="back-link" id="back-link">← Back to BrokerZ</a>

  <div class="login-card">
    <a href="index.html?reset=1" class="logo">Broker<span>Z</span></a>

    <p class="portal-badge" id="portal-badge">Sign in as <span id="portal-label">Client</span></p>
    <div class="portal-tabs">
      <button type="button" class="portal-tab active" data-portal="client" id="tab-client">I'm a Client</button>
      <button type="button" class="portal-tab" data-portal="broker" id="tab-broker">I'm a Broker</button>
    </div>

    <!-- Sign in -->
    <div id="signin-panel" class="form-panel active">
      <h2 class="form-title" id="signin-title">Sign in</h2>
      <form id="signin-form" novalidate>
        <div class="field">
          <label for="signin-email" id="signin-email-label">Email</label>
          <input type="email" id="signin-email" name="email" placeholder="you@example.com" required autocomplete="email" />
          <span class="error-msg" id="signin-email-err"></span>
        </div>
        <div class="field">
          <label for="signin-password" id="signin-password-label">Password</label>
          <input type="password" id="signin-password" name="password" placeholder="••••••••" required autocomplete="current-password" />
          <span class="error-msg" id="signin-password-err"></span>
        </div>
        <div class="error-msg form-err visible" id="signin-form-err" style="display: none;"></div>
        <button type="submit" class="submit-btn" id="signin-btn">Sign in</button>
      </form>
      <p class="toggle-mode"><span id="signin-toggle-text">Don't have an account?</span> <a href="#" id="go-signup">Sign up</a></p>
    </div>

    <!-- Sign up -->
    <div id="signup-panel" class="form-panel">
      <h2 class="form-title" id="signup-title">Create account</h2>
      <form id="signup-form" novalidate>
        <div class="row">
          <div class="field">
            <label for="signup-firstname" id="signup-firstname-label">First name</label>
            <input type="text" id="signup-firstname" name="firstName" placeholder="First name" required autocomplete="given-name" />
            <span class="error-msg" id="signup-firstname-err"></span>
          </div>
          <div class="field">
            <label for="signup-lastname" id="signup-lastname-label">Last name</label>
            <input type="text" id="signup-lastname" name="lastName" placeholder="Last name" required autocomplete="family-name" />
            <span class="error-msg" id="signup-lastname-err"></span>
          </div>
        </div>
        <div class="field">
          <label for="signup-email" id="signup-email-label">Email</label>
          <input type="email" id="signup-email" name="email" placeholder="you@example.com" required autocomplete="email" />
          <span class="error-msg" id="signup-email-err"></span>
        </div>
        <div class="field">
          <label for="signup-password" id="signup-password-label">Password</label>
          <input type="password" id="signup-password" name="password" placeholder="••••••••" required minlength="6" autocomplete="new-password" />
          <span class="error-msg" id="signup-password-err"></span>
        </div>
        <div class="field">
          <label for="signup-confirm" id="signup-confirm-label">Confirm password</label>
          <input type="password" id="signup-confirm" name="confirmPassword" placeholder="••••••••" required autocomplete="new-password" />
          <span class="error-msg" id="signup-confirm-err"></span>
        </div>
        <div class="error-msg form-err visible" id="signup-form-err" style="display: none;"></div>
        <button type="submit" class="submit-btn" id="signup-btn">Sign up</button>
      </form>
      <p class="toggle-mode"><span id="signup-toggle-text">Already have an account?</span> <a href="#" id="go-signin">Sign in</a></p>
    </div>
  </div>

  <script>
    (function () {
      var portalTabs = document.querySelectorAll('.portal-tab');
      var portalLabel = document.getElementById('portal-label');
      var signinPanel = document.getElementById('signin-panel');
      var signupPanel = document.getElementById('signup-panel');
      var goSignup = document.getElementById('go-signup');
      var goSignin = document.getElementById('go-signin');
      var signinForm = document.getElementById('signin-form');
      var signupForm = document.getElementById('signup-form');
      var langToggle = document.getElementById('lang-toggle');
      var currentLanguage = localStorage.getItem('brokerz_lang') || ((navigator.language || '').toLowerCase().indexOf('ar') === 0 ? 'ar' : 'en');

      var currentPortal = 'client';
      var i18n = {
        en: {
          title: 'Sign in — BrokerZ',
          back: '← Back to BrokerZ',
          badgePrefix: 'Sign in as ',
          tabClient: "I'm a Client",
          tabBroker: "I'm a Broker",
          client: 'Client',
          broker: 'Broker',
          signIn: 'Sign in',
          createAccount: 'Create account',
          email: 'Email',
          password: 'Password',
          firstName: 'First name',
          lastName: 'Last name',
          confirmPassword: 'Confirm password',
          noAccount: "Don't have an account?",
          haveAccount: 'Already have an account?',
          signUp: 'Sign up',
          emailRequired: 'Email is required',
          passwordRequired: 'Password is required',
          firstRequired: 'First name is required',
          lastRequired: 'Last name is required',
          passwordMin: 'Password must be at least 6 characters',
          confirmRequired: 'Please confirm your password',
          confirmMismatch: 'Passwords do not match',
          signInFailed: 'Sign in failed.',
          signUpFailed: 'Sign up failed.',
          networkError: 'Network error. Is the server running?'
        },
        ar: {
          title: 'تسجيل الدخول — BrokerZ',
          back: '← العودة إلى BrokerZ',
          badgePrefix: 'تسجيل الدخول كـ ',
          tabClient: 'أنا عميل',
          tabBroker: 'أنا وسيط',
          client: 'عميل',
          broker: 'وسيط',
          signIn: 'تسجيل الدخول',
          createAccount: 'إنشاء حساب',
          email: 'البريد الإلكتروني',
          password: 'كلمة المرور',
          firstName: 'الاسم الأول',
          lastName: 'اسم العائلة',
          confirmPassword: 'تأكيد كلمة المرور',
          noAccount: 'ليس لديك حساب؟',
          haveAccount: 'لديك حساب بالفعل؟',
          signUp: 'إنشاء حساب',
          emailRequired: 'البريد الإلكتروني مطلوب',
          passwordRequired: 'كلمة المرور مطلوبة',
          firstRequired: 'الاسم الأول مطلوب',
          lastRequired: 'اسم العائلة مطلوب',
          passwordMin: 'كلمة المرور يجب أن تكون 6 أحرف على الأقل',
          confirmRequired: 'يرجى تأكيد كلمة المرور',
          confirmMismatch: 'كلمتا المرور غير متطابقتين',
          signInFailed: 'فشل تسجيل الدخول.',
          signUpFailed: 'فشل إنشاء الحساب.',
          networkError: 'خطأ في الشبكة. هل الخادم يعمل؟'
        }
      };

      function t(key) {
        return i18n[currentLanguage][key];
      }

      function applyLanguage() {
        document.documentElement.lang = currentLanguage;
        document.body.dir = currentLanguage === 'ar' ? 'rtl' : 'ltr';
        document.title = t('title');
        if (langToggle) langToggle.textContent = currentLanguage === 'en' ? 'AR' : 'EN';
        document.getElementById('back-link').textContent = t('back');
        document.getElementById('portal-badge').childNodes[0].nodeValue = t('badgePrefix');
        document.getElementById('tab-client').textContent = t('tabClient');
        document.getElementById('tab-broker').textContent = t('tabBroker');
        document.getElementById('signin-title').textContent = t('signIn');
        document.getElementById('signin-email-label').textContent = t('email');
        document.getElementById('signin-password-label').textContent = t('password');
        document.getElementById('signin-btn').textContent = t('signIn');
        document.getElementById('signin-toggle-text').textContent = t('noAccount');
        document.getElementById('go-signup').textContent = t('signUp');
        document.getElementById('signup-title').textContent = t('createAccount');
        document.getElementById('signup-firstname-label').textContent = t('firstName');
        document.getElementById('signup-lastname-label').textContent = t('lastName');
        document.getElementById('signup-email-label').textContent = t('email');
        document.getElementById('signup-password-label').textContent = t('password');
        document.getElementById('signup-confirm-label').textContent = t('confirmPassword');
        document.getElementById('signup-btn').textContent = t('signUp');
        document.getElementById('signup-toggle-text').textContent = t('haveAccount');
        document.getElementById('go-signin').textContent = t('signIn');
        portalLabel.textContent = currentPortal === 'broker' ? t('broker') : t('client');
      }

      // Portal switch
      portalTabs.forEach(function (tab) {
        tab.addEventListener('click', function () {
          currentPortal = this.getAttribute('data-portal');
          portalTabs.forEach(function (t) { t.classList.remove('active'); });
          this.classList.add('active');
          portalLabel.textContent = currentPortal === 'broker' ? t('broker') : t('client');
        });
      });

      // Toggle sign in / sign up
      goSignup.addEventListener('click', function (e) {
        e.preventDefault();
        signinPanel.classList.remove('active');
        signupPanel.classList.add('active');
      });
      goSignin.addEventListener('click', function (e) {
        e.preventDefault();
        signupPanel.classList.remove('active');
        signinPanel.classList.add('active');
      });

      // Clear field errors
      function clearErrors(form) {
        form.querySelectorAll('.field input').forEach(function (input) {
          input.classList.remove('error');
        });
        form.querySelectorAll('.error-msg').forEach(function (el) {
          el.classList.remove('visible');
          el.textContent = '';
        });
      }

      function showFormError(formId, text) {
        var el = document.getElementById(formId);
        el.textContent = text || '';
        el.style.display = text ? 'block' : 'none';
      }

      // Sign in submit
      signinForm.addEventListener('submit', function (e) {
        e.preventDefault();
        clearErrors(signinForm);
        showFormError('signin-form-err', '');
        var email = document.getElementById('signin-email').value.trim();
        var password = document.getElementById('signin-password').value;
        var valid = true;
        if (!email) {
          document.getElementById('signin-email-err').textContent = t('emailRequired');
          document.getElementById('signin-email-err').classList.add('visible');
          document.getElementById('signin-email').classList.add('error');
          valid = false;
        }
        if (!password) {
          document.getElementById('signin-password-err').textContent = t('passwordRequired');
          document.getElementById('signin-password-err').classList.add('visible');
          document.getElementById('signin-password').classList.add('error');
          valid = false;
        }
        if (!valid) return;

        var btn = document.getElementById('signin-btn');
        btn.disabled = true;
        fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email: email, password: password, portal: currentPortal })
        })
          .then(function (res) { return res.json().then(function (data) { return { status: res.status, data: data }; }); })
          .then(function (result) {
            if (result.status === 200 && result.data.token) {
              localStorage.setItem('brokerz_token', result.data.token);
              localStorage.setItem('brokerz_user', JSON.stringify(result.data.user));
              window.location.href = 'index.html?reset=1';
            } else {
              showFormError('signin-form-err', result.data.error || t('signInFailed'));
            }
          })
          .catch(function () { showFormError('signin-form-err', t('networkError')); })
          .finally(function () { btn.disabled = false; });
      });

      // Sign up submit with password confirmation
      signupForm.addEventListener('submit', function (e) {
        e.preventDefault();
        clearErrors(signupForm);
        var firstName = document.getElementById('signup-firstname').value.trim();
        var lastName = document.getElementById('signup-lastname').value.trim();
        var email = document.getElementById('signup-email').value.trim();
        var password = document.getElementById('signup-password').value;
        var confirm = document.getElementById('signup-confirm').value;
        var valid = true;

        if (!firstName) {
          showFieldError('signup-firstname', 'signup-firstname-err', t('firstRequired'));
          valid = false;
        }
        if (!lastName) {
          showFieldError('signup-lastname', 'signup-lastname-err', t('lastRequired'));
          valid = false;
        }
        if (!email) {
          showFieldError('signup-email', 'signup-email-err', t('emailRequired'));
          valid = false;
        }
        if (!password) {
          showFieldError('signup-password', 'signup-password-err', t('passwordRequired'));
          valid = false;
        } else if (password.length < 6) {
          showFieldError('signup-password', 'signup-password-err', t('passwordMin'));
          valid = false;
        }
        if (!confirm) {
          showFieldError('signup-confirm', 'signup-confirm-err', t('confirmRequired'));
          valid = false;
        } else if (password !== confirm) {
          showFieldError('signup-confirm', 'signup-confirm-err', t('confirmMismatch'));
          document.getElementById('signup-confirm').classList.add('error');
          valid = false;
        }

        if (!valid) return;

        showFormError('signup-form-err', '');
        var btn = document.getElementById('signup-btn');
        btn.disabled = true;
        fetch('/api/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            firstName: firstName,
            lastName: lastName,
            email: email,
            password: password,
            confirmPassword: confirm,
            portal: currentPortal
          })
        })
          .then(function (res) { return res.json().then(function (data) { return { status: res.status, data: data }; }); })
          .then(function (result) {
            if (result.status === 201 && result.data.token) {
              localStorage.setItem('brokerz_token', result.data.token);
              localStorage.setItem('brokerz_user', JSON.stringify(result.data.user));
              window.location.href = 'index.html?reset=1';
            } else {
              showFormError('signup-form-err', result.data.error || t('signUpFailed'));
            }
          })
          .catch(function () { showFormError('signup-form-err', t('networkError')); })
          .finally(function () { btn.disabled = false; });
      });

      function showFieldError(inputId, msgId, text) {
        document.getElementById(inputId).classList.add('error');
        var el = document.getElementById(msgId);
        el.textContent = text;
        el.classList.add('visible');
      }

      if (langToggle) {
        langToggle.addEventListener('click', function () {
          currentLanguage = currentLanguage === 'en' ? 'ar' : 'en';
          localStorage.setItem('brokerz_lang', currentLanguage);
          applyLanguage();
        });
      }

      applyLanguage();
    })();
  </script>
</body>
</html>
